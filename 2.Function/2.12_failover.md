## 2.12 故障切换  
版本2.20.04.0起对切换功能进行了重定义,废除原有的切换功能，请知悉。  
新的MySQL高可用切换分为两类:  
一个是单实例部署的dble会内置一个自带的高可用切换的python3脚本，跟随dble启动和停止,需要设置system的useOuterHa 参数为false。  
另一个是支持第三方的高可用切换接口功能，支持集群部署。当然，单实例dble也可以采用这种方式，需要设置system的useOuterHa 参数为true.  
这种方式情况下，如果没有真的配置第三方高可用切换组件，则什么也不会发生。
具体请参考[高可用切换接口](2.23_outerHa_linkage.md)

### 2.12.1  前提条件
单实例部署的dble，设置system的useOuterHa 参数为false。


### 2.12.2 工作方式
dble启动时跟随dble启动python3脚本进程，脚本会读取schema.xml内部的配置，检查后端数据库结点的状态，发生异常后会执行切换命令来通知dble

dble提供以下运维命令： 
``` 
show @@custom_mysql_ha  
```
用于查看或者监控当前进程是否存活

当python脚本意外终止时，
可以手工运行命令来启动：
```
enable @@custom_mysql_ha
```

当然，也可以手动关闭该脚本  
```
disable @@custom_mysql_ha
```

### 2.12.2 注意事项
#### 2.12.2.1 此功能目前只支持linux。   
#### 2.12.2.2 reload注意事项  
做reload @@config操作时，未防止python脚本读到脏配置，我们建议的手工流程为：  
1.```disable @@custom_mysql_ha```  关闭切换功能  
2.修改配置文件  
3.```reload @@config```  重新加载配置  
4.```enable @@custom_mysql_ha``` 开启切换功能  
#### 2.12.2.3 自定义python脚本
当然, custom\_mysql\_ha.py 脚本在dble安装目录的bin目录下，您可以根据实际情况自行修改 

 





